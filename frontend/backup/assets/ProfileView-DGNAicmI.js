import{_ as K}from"./_plugin-vue_export-helper-BJA4NJ9J.js";/* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                  *//* empty css                    *//* empty css                 *//* empty css                *//* empty css                  */import{u as X,A as B,h as Z}from"./index-Co-C_Vux.js";import{y as ee,E as d,A as ae,z as se,q as oe,$ as le,a0 as te,b as re,c as ne,d as de,R as ie,f as ue,_ as me,G as ce,F as pe}from"./element-CUclIBtA.js";import{y as fe,r as f,l as h,c as L,h as _e,z as k,R as a,J as l,B as s,O as v,P as i,Q as ve,a6 as we,A as C,I as ge}from"./vendor-B2dHd6i_.js";import"./utils-xdQVjYpF.js";const Pe={class:"profile"},ye={class:"profile-header"},be={class:"profile-roles"},Ve={class:"profile-stats"},he={class:"stat-item"},Ce={class:"stat-value"},Ee={class:"stat-item"},Ae={class:"stat-value"},Ue={class:"stat-item"},Fe={class:"stat-value"},Ie={class:"security-settings"},xe={class:"security-item"},Re={class:"security-item"},Se={class:"security-item"},Be={class:"security-info"},Le=fe({__name:"ProfileView",setup(ke){const P=X(),E=f("basic"),p=f(!1),y=f(),b=f(),m=f({id:0,username:"",email:"",avatar:"",roles:[],createdAt:"",updatedAt:""}),w=f({recordCount:0,fileCount:0,loginCount:0}),r=h({username:"",email:"",avatar:""}),n=h({oldPassword:"",newPassword:"",confirmPassword:""}),g=h({loginProtection:!1,operationLog:!0}),T=L(()=>B.FILES.UPLOAD),z=L(()=>({Authorization:`Bearer ${P.token}`})),M={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}]},q={oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:50,message:"密码长度在 6 到 50 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(o,e,c)=>{e!==n.newPassword?c(new Error("两次输入的密码不一致")):c()},trigger:"blur"}]},D=o=>o?ce(o).format("YYYY-MM-DD HH:mm:ss"):"从未登录",A=async()=>{try{const o=await Z.get(B.AUTH.PROFILE);m.value=o,r.username=o.username,r.email=o.email,r.avatar=o.avatar||""}catch(o){console.error("Failed to load user info:",o),d.error("加载用户信息失败")}},N=async()=>{try{w.value={recordCount:156,fileCount:89,loginCount:234}}catch(o){console.error("Failed to load stats:",o)}},O=o=>{const e=o.type.startsWith("image/"),c=o.size/1024/1024<2;return e?c?!0:(d.error("图片大小不能超过 2MB"),!1):(d.error("只能上传图片文件"),!1)},H=o=>{r.avatar=o.file.path,d.success("头像上传成功")},Y=o=>{console.error("Avatar upload failed:",o),d.error("头像上传失败")},j=async()=>{if(y.value)try{await y.value.validate(),p.value=!0,await P.updateProfile({email:r.email,avatar:r.avatar}),d.success("个人信息更新成功"),await A()}catch(o){console.error("Update profile failed:",o),d.error(o.message||"更新失败")}finally{p.value=!1}},$=async()=>{if(b.value)try{await b.value.validate(),p.value=!0,await P.changePassword({oldPassword:n.oldPassword,newPassword:n.newPassword}),d.success("密码修改成功"),Object.assign(n,{oldPassword:"",newPassword:"",confirmPassword:""})}catch(o){console.error("Change password failed:",o),d.error(o.message||"密码修改失败")}finally{p.value=!1}},U=()=>{d.success("安全设置已更新")};return _e(()=>{A(),N()}),(o,e)=>{const c=oe,G=pe,F=se,I=ae,_=de,u=ne,J=ie,x=ue,R=re,V=te,S=me,Q=le,W=ee;return C(),k("div",Pe,[a(W,{gutter:20},{default:l(()=>[a(I,{xs:24,lg:8},{default:l(()=>[a(F,{class:"profile-card"},{default:l(()=>[s("div",ye,[a(c,{size:80,src:m.value.avatar},{default:l(()=>{var t;return[v(i((t=m.value.username)==null?void 0:t.charAt(0).toUpperCase()),1)]}),_:1},8,["src"]),s("h3",null,i(m.value.username),1),s("p",null,i(m.value.email),1),s("div",be,[(C(!0),k(ve,null,we(m.value.roles,t=>(C(),ge(G,{key:t.id,type:"primary",size:"small"},{default:l(()=>[v(i(t.name),1)]),_:2},1024))),128))])]),s("div",Ve,[s("div",he,[s("div",Ce,i(w.value.recordCount),1),e[8]||(e[8]=s("div",{class:"stat-label"},"创建记录",-1))]),s("div",Ee,[s("div",Ae,i(w.value.fileCount),1),e[9]||(e[9]=s("div",{class:"stat-label"},"上传文件",-1))]),s("div",Ue,[s("div",Fe,i(w.value.loginCount),1),e[10]||(e[10]=s("div",{class:"stat-label"},"登录次数",-1))])])]),_:1})]),_:1}),a(I,{xs:24,lg:16},{default:l(()=>[a(F,{title:"个人信息"},{default:l(()=>[a(Q,{modelValue:E.value,"onUpdate:modelValue":e[7]||(e[7]=t=>E.value=t)},{default:l(()=>[a(V,{label:"基本信息",name:"basic"},{default:l(()=>[a(R,{ref_key:"basicFormRef",ref:y,model:r,rules:M,"label-width":"100px"},{default:l(()=>[a(u,{label:"用户名",prop:"username"},{default:l(()=>[a(_,{modelValue:r.username,"onUpdate:modelValue":e[0]||(e[0]=t=>r.username=t),placeholder:"请输入用户名",disabled:""},null,8,["modelValue"]),e[11]||(e[11]=s("div",{class:"form-tip"},"用户名不可修改",-1))]),_:1}),a(u,{label:"邮箱",prop:"email"},{default:l(()=>[a(_,{modelValue:r.email,"onUpdate:modelValue":e[1]||(e[1]=t=>r.email=t),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),a(u,{label:"头像"},{default:l(()=>[a(J,{action:T.value,headers:z.value,"on-success":H,"on-error":Y,"before-upload":O,"show-file-list":!1,accept:"image/*"},{default:l(()=>[a(c,{size:60,src:r.avatar},{default:l(()=>{var t;return[v(i((t=r.username)==null?void 0:t.charAt(0).toUpperCase()),1)]}),_:1},8,["src"]),e[12]||(e[12]=s("div",{class:"avatar-tip"},"点击更换头像",-1))]),_:1},8,["action","headers"])]),_:1}),a(u,null,{default:l(()=>[a(x,{type:"primary",loading:p.value,onClick:j},{default:l(()=>[...e[13]||(e[13]=[v(" 保存修改 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),a(V,{label:"修改密码",name:"password"},{default:l(()=>[a(R,{ref_key:"passwordFormRef",ref:b,model:n,rules:q,"label-width":"100px"},{default:l(()=>[a(u,{label:"当前密码",prop:"oldPassword"},{default:l(()=>[a(_,{modelValue:n.oldPassword,"onUpdate:modelValue":e[2]||(e[2]=t=>n.oldPassword=t),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),a(u,{label:"新密码",prop:"newPassword"},{default:l(()=>[a(_,{modelValue:n.newPassword,"onUpdate:modelValue":e[3]||(e[3]=t=>n.newPassword=t),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),a(u,{label:"确认密码",prop:"confirmPassword"},{default:l(()=>[a(_,{modelValue:n.confirmPassword,"onUpdate:modelValue":e[4]||(e[4]=t=>n.confirmPassword=t),type:"password",placeholder:"请确认新密码","show-password":""},null,8,["modelValue"])]),_:1}),a(u,null,{default:l(()=>[a(x,{type:"primary",loading:p.value,onClick:$},{default:l(()=>[...e[14]||(e[14]=[v(" 修改密码 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),a(V,{label:"安全设置",name:"security"},{default:l(()=>[s("div",Ie,[s("div",xe,[e[15]||(e[15]=s("div",{class:"security-info"},[s("h4",null,"登录保护"),s("p",null,"开启后需要验证身份才能登录")],-1)),a(S,{modelValue:g.loginProtection,"onUpdate:modelValue":e[5]||(e[5]=t=>g.loginProtection=t),onChange:U},null,8,["modelValue"])]),s("div",Re,[e[16]||(e[16]=s("div",{class:"security-info"},[s("h4",null,"操作日志"),s("p",null,"记录您的所有操作行为")],-1)),a(S,{modelValue:g.operationLog,"onUpdate:modelValue":e[6]||(e[6]=t=>g.operationLog=t),onChange:U},null,8,["modelValue"])]),s("div",Se,[s("div",Be,[e[17]||(e[17]=s("h4",null,"最后登录时间",-1)),s("p",null,i(D(m.value.lastLogin)),1)])])])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})])}}}),Ke=K(Le,[["__scopeId","data-v-33170a4e"]]);export{Ke as default};
//# sourceMappingURL=ProfileView-DGNAicmI.js.map
