import{_ as De}from"./_plugin-vue_export-helper-BJA4NJ9J.js";/* empty css                   *//* empty css                   *//* empty css                      *//* empty css                *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                   *//* empty css                  *//* empty css                  *//* empty css                    */import{y as Se,r as v,l as Le,c as Z,h as Fe,z as w,R as l,K as Oe,J as a,I as u,B as s,O as f,al as g,a4 as Re,M as ee,P as m,L as F,Q as ze,a6 as Be,A as r,W as Ie}from"./vendor-B2dHd6i_.js";import{u as Ve,A as y,h as b}from"./index-Co-C_Vux.js";import{z as Ue,H as $e,I as Pe,E as c,R as Te,f as Me,l as Ne,d as Ae,J as We,K as Ke,n as je,M as He,N as Ge,U as Ye,P as Je,Q as Qe,G as qe,u as te}from"./element-CUclIBtA.js";import"./utils-xdQVjYpF.js";const Xe={class:"file-list"},Ze={class:"action-bar"},et={class:"action-left"},tt={class:"action-right"},lt={class:"file-info"},ot={class:"file-icon"},at={class:"file-details"},nt={class:"file-name"},st={class:"file-meta"},it={key:1,class:"grid-view"},rt=["onClick"],ct={class:"file-preview"},dt={key:1,class:"file-type-icon"},ut={class:"file-card-info"},pt=["title"],ft={class:"file-card-meta"},mt={class:"file-card-time"},_t={class:"pagination-wrapper"},vt={key:0,class:"ocr-result"},gt={class:"ocr-image"},ht={class:"ocr-text"},yt={class:"ocr-meta"},Ct={key:1,class:"ocr-loading"},wt=Se({__name:"FileListView",setup(kt){const O=Ve(),I=v(!1),E=v("grid"),V=v([]),k=v([]),R=v(""),z=v(""),x=v(!1),p=v(null),M=v(null),d=Le({page:1,pageSize:24,total:0}),le=Z(()=>y.FILES.UPLOAD),oe=Z(()=>({Authorization:`Bearer ${O.token}`})),N=e=>qe(e).format("YYYY-MM-DD HH:mm"),A=e=>e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:e<1024*1024*1024?`${(e/(1024*1024)).toFixed(1)} MB`:`${(e/(1024*1024*1024)).toFixed(1)} GB`,C=e=>e.startsWith("image/"),D=e=>`${y.FILES.DOWNLOAD(e.id)}`,W=e=>e.startsWith("image/")?"Picture":e.startsWith("video/")?"VideoPlay":e.startsWith("audio/")?"Headphone":e.includes("pdf")||e.includes("word")||e.includes("document")||e.includes("excel")||e.includes("spreadsheet")||e.includes("powerpoint")||e.includes("presentation")?"Document":e.includes("zip")||e.includes("rar")?"FolderOpened":"Document",K=e=>e.startsWith("image/")?"#67c23a":e.startsWith("video/")?"#409eff":e.startsWith("audio/")?"#e6a23c":e.includes("pdf")?"#f56c6c":e.includes("word")?"#409eff":e.includes("excel")?"#67c23a":e.includes("powerpoint")?"#e6a23c":"#909399",j=e=>{var t;return O.hasPermission("files","delete")&&(O.hasPermission("files","delete","all")||e.uploadedBy===((t=O.user)==null?void 0:t.id))},h=async()=>{try{I.value=!0;const e={page:d.page,pageSize:d.pageSize};R.value&&(e.keyword=R.value),z.value&&(e.type=z.value);const t=await b.get(y.FILES.LIST,{params:e});V.value=t.items,d.total=t.total}catch(e){console.error("Failed to load files:",e),c.error("加载文件列表失败")}finally{I.value=!1}},U=()=>{d.page=1,h()},ae=e=>{d.page=e,h()},ne=e=>{d.pageSize=e,d.page=1,h()},se=e=>{k.value=e},ie=e=>e.size/1024/1024<50?!0:(c.error("文件大小不能超过 50MB"),!1),re=e=>{c.success("文件上传成功"),h()},ce=e=>{console.error("File upload failed:",e),c.error("文件上传失败")},de=e=>{C(e.mimeType)||$(e)},$=async e=>{try{const t=await b.get(y.FILES.DOWNLOAD(e.id),{responseType:"blob"}),B=new Blob([t]),i=window.URL.createObjectURL(B),n=document.createElement("a");n.href=i,n.download=e.originalName,n.click(),window.URL.revokeObjectURL(i)}catch(t){console.error("Download failed:",t),c.error("下载失败")}},H=async e=>{if(!C(e.mimeType)){c.warning("只能对图片文件进行OCR识别");return}try{M.value=e,p.value=null,x.value=!0;const t=await b.post(y.FILES.OCR,{fileId:e.id});p.value=t}catch(t){console.error("OCR failed:",t),c.error("OCR识别失败"),x.value=!1}},G=async e=>{try{await b.delete(y.FILES.DELETE(e.id)),c.success("文件删除成功"),h()}catch(t){console.error("Delete failed:",t),c.error("删除失败")}},ue=async()=>{const e=k.value.filter(t=>C(t.mimeType));if(e.length===0){c.warning("请选择图片文件进行OCR识别");return}try{const t=e.map(n=>b.post(y.FILES.OCR,{fileId:n.id})),i=(await Promise.all(t)).map(n=>n.text).join(`

`);await te.alert(i,"批量OCR识别结果",{confirmButtonText:"复制全部",callback:()=>{navigator.clipboard.writeText(i),c.success("已复制到剪贴板")}})}catch(t){console.error("Batch OCR failed:",t),c.error("批量OCR识别失败")}},pe=async()=>{try{await te.confirm(`确定要删除选中的 ${k.value.length} 个文件吗？`,"批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=k.value.map(t=>b.delete(y.FILES.DELETE(t.id)));await Promise.all(e),c.success("批量删除成功"),h()}catch(e){e!=="cancel"&&(console.error("Batch delete failed:",e),c.error("批量删除失败"))}},fe=()=>{p.value&&(navigator.clipboard.writeText(p.value.text),c.success("已复制到剪贴板"))};return Fe(()=>{h()}),(e,t)=>{const B=g("Upload"),i=Ne,n=Me,me=Te,Y=g("Camera"),J=g("Delete"),_e=g("Search"),Q=Ae,S=Ke,ve=We,ge=g("Refresh"),P=je,he=g("List"),ye=g("Grid"),q=Ue,L=Ge,T=Ye,X=Je,Ce=He,we=g("Download"),ke=Qe,be=g("Loading"),Ee=Pe,xe=$e;return r(),w("div",Xe,[l(q,{class:"action-card",shadow:"never"},{default:a(()=>[s("div",Ze,[s("div",et,[l(me,{action:le.value,headers:oe.value,"on-success":re,"on-error":ce,"before-upload":ie,"show-file-list":!1,multiple:""},{default:a(()=>[l(n,{type:"primary"},{default:a(()=>[l(i,null,{default:a(()=>[l(B)]),_:1}),t[10]||(t[10]=f(" 上传文件 ",-1))]),_:1})]),_:1},8,["action","headers"]),l(n,{type:"success",onClick:ue,disabled:k.value.length===0},{default:a(()=>[l(i,null,{default:a(()=>[l(Y)]),_:1}),t[11]||(t[11]=f(" 批量OCR ",-1))]),_:1},8,["disabled"]),l(n,{type:"danger",onClick:pe,disabled:k.value.length===0},{default:a(()=>[l(i,null,{default:a(()=>[l(J)]),_:1}),t[12]||(t[12]=f(" 批量删除 ",-1))]),_:1},8,["disabled"])]),s("div",tt,[l(Q,{modelValue:R.value,"onUpdate:modelValue":t[0]||(t[0]=o=>R.value=o),placeholder:"搜索文件名",clearable:"",onKeyup:Re(U,["enter"]),style:{width:"200px"}},{append:a(()=>[l(n,{onClick:U},{default:a(()=>[l(i,null,{default:a(()=>[l(_e)]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(ve,{modelValue:z.value,"onUpdate:modelValue":t[1]||(t[1]=o=>z.value=o),placeholder:"文件类型",clearable:"",onChange:U,style:{width:"120px"}},{default:a(()=>[l(S,{label:"图片",value:"image"}),l(S,{label:"文档",value:"document"}),l(S,{label:"视频",value:"video"}),l(S,{label:"音频",value:"audio"}),l(S,{label:"其他",value:"other"})]),_:1},8,["modelValue"]),l(P,{content:"刷新"},{default:a(()=>[l(n,{circle:"",onClick:h},{default:a(()=>[l(i,null,{default:a(()=>[l(ge)]),_:1})]),_:1})]),_:1}),l(P,{content:"列表视图"},{default:a(()=>[l(n,{circle:"",type:E.value==="list"?"primary":"default",onClick:t[2]||(t[2]=o=>E.value="list")},{default:a(()=>[l(i,null,{default:a(()=>[l(he)]),_:1})]),_:1},8,["type"])]),_:1}),l(P,{content:"网格视图"},{default:a(()=>[l(n,{circle:"",type:E.value==="grid"?"primary":"default",onClick:t[3]||(t[3]=o=>E.value="grid")},{default:a(()=>[l(i,null,{default:a(()=>[l(ye)]),_:1})]),_:1},8,["type"])]),_:1})])])]),_:1}),Oe((r(),u(q,{class:"list-card"},{default:a(()=>[E.value==="list"?(r(),u(Ce,{key:0,data:V.value,onSelectionChange:se,stripe:"",style:{width:"100%"}},{default:a(()=>[l(L,{type:"selection",width:"55"}),l(L,{label:"文件","min-width":"300"},{default:a(({row:o})=>[s("div",lt,[s("div",ot,[C(o.mimeType)?(r(),u(T,{key:0,src:D(o),"preview-src-list":[D(o)],fit:"cover",style:{width:"40px",height:"40px","border-radius":"4px"}},null,8,["src","preview-src-list"])):(r(),u(i,{key:1,size:32,color:K(o.mimeType)},{default:a(()=>[(r(),u(ee(W(o.mimeType))))]),_:2},1032,["color"]))]),s("div",at,[s("div",nt,m(o.originalName),1),s("div",st,m(A(o.size))+" • "+m(o.mimeType),1)])])]),_:1}),l(L,{prop:"uploader",label:"上传者",width:"120"},{default:a(({row:o})=>{var _;return[f(m(((_=o.uploader)==null?void 0:_.username)||"未知"),1)]}),_:1}),l(L,{prop:"createdAt",label:"上传时间",width:"180"},{default:a(({row:o})=>[f(m(N(o.createdAt)),1)]),_:1}),l(L,{label:"操作",width:"200",fixed:"right"},{default:a(({row:o})=>[l(n,{size:"small",onClick:_=>$(o)},{default:a(()=>[...t[13]||(t[13]=[f(" 下载 ",-1)])]),_:1},8,["onClick"]),C(o.mimeType)?(r(),u(n,{key:0,size:"small",type:"success",onClick:_=>H(o)},{default:a(()=>[...t[14]||(t[14]=[f(" OCR ",-1)])]),_:1},8,["onClick"])):F("",!0),j(o)?(r(),u(X,{key:1,title:"确定要删除这个文件吗？",onConfirm:_=>G(o)},{reference:a(()=>[l(n,{size:"small",type:"danger"},{default:a(()=>[...t[15]||(t[15]=[f(" 删除 ",-1)])]),_:1})]),_:1},8,["onConfirm"])):F("",!0)]),_:1})]),_:1},8,["data"])):(r(),w("div",it,[(r(!0),w(ze,null,Be(V.value,o=>(r(),w("div",{key:o.id,class:"file-card",onClick:_=>de(o)},[s("div",ct,[C(o.mimeType)?(r(),u(T,{key:0,src:D(o),"preview-src-list":[D(o)],fit:"cover",class:"preview-image"},null,8,["src","preview-src-list"])):(r(),w("div",dt,[l(i,{size:48,color:K(o.mimeType)},{default:a(()=>[(r(),u(ee(W(o.mimeType))))]),_:2},1032,["color"])]))]),s("div",ut,[s("div",{class:"file-card-name",title:o.originalName},m(o.originalName),9,pt),s("div",ft,m(A(o.size)),1),s("div",mt,m(N(o.createdAt)),1)]),s("div",{class:"file-card-actions",onClick:t[4]||(t[4]=Ie(()=>{},["stop"]))},[l(n,{size:"small",onClick:_=>$(o)},{default:a(()=>[l(i,null,{default:a(()=>[l(we)]),_:1})]),_:1},8,["onClick"]),C(o.mimeType)?(r(),u(n,{key:0,size:"small",type:"success",onClick:_=>H(o)},{default:a(()=>[l(i,null,{default:a(()=>[l(Y)]),_:1})]),_:1},8,["onClick"])):F("",!0),j(o)?(r(),u(X,{key:1,title:"确定要删除吗？",onConfirm:_=>G(o)},{reference:a(()=>[l(n,{size:"small",type:"danger"},{default:a(()=>[l(i,null,{default:a(()=>[l(J)]),_:1})]),_:1})]),_:1},8,["onConfirm"])):F("",!0)])],8,rt))),128))])),s("div",_t,[l(ke,{"current-page":d.page,"onUpdate:currentPage":t[5]||(t[5]=o=>d.page=o),"page-size":d.pageSize,"onUpdate:pageSize":t[6]||(t[6]=o=>d.pageSize=o),"page-sizes":[12,24,48,96],total:d.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ne,onCurrentChange:ae},null,8,["current-page","page-size","total"])])]),_:1})),[[xe,I.value]]),l(Ee,{modelValue:x.value,"onUpdate:modelValue":t[9]||(t[9]=o=>x.value=o),title:"OCR识别结果",width:"600px"},{footer:a(()=>[l(n,{onClick:t[8]||(t[8]=o=>x.value=!1)},{default:a(()=>[...t[18]||(t[18]=[f("关闭",-1)])]),_:1}),p.value?(r(),u(n,{key:0,type:"primary",onClick:fe},{default:a(()=>[...t[19]||(t[19]=[f(" 复制文本 ",-1)])]),_:1})):F("",!0)]),default:a(()=>[p.value?(r(),w("div",vt,[s("div",gt,[l(T,{src:D(M.value),fit:"contain",style:{"max-height":"200px"}},null,8,["src"])]),s("div",ht,[t[16]||(t[16]=s("h4",null,"识别文本：",-1)),l(Q,{modelValue:p.value.text,"onUpdate:modelValue":t[7]||(t[7]=o=>p.value.text=o),type:"textarea",rows:8,readonly:""},null,8,["modelValue"]),s("div",yt,[s("p",null,"置信度："+m((p.value.confidence*100).toFixed(1))+"%",1),s("p",null,"语言："+m(p.value.language),1)])])])):(r(),w("div",Ct,[l(i,{class:"is-loading"},{default:a(()=>[l(be)]),_:1}),t[17]||(t[17]=s("p",null,"正在识别中，请稍候...",-1))]))]),_:1},8,["modelValue"])])}}}),At=De(wt,[["__scopeId","data-v-b401f28b"]]);export{At as default};
//# sourceMappingURL=FileListView-bXkRdWnh.js.map
