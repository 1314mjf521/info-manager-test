const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LoginView-CKwenYqG.js","assets/_plugin-vue_export-helper-BJA4NJ9J.js","assets/_plugin-vue_export-helper-B0cSg007.css","assets/vendor-B2dHd6i_.js","assets/element-CUclIBtA.js","assets/utils-xdQVjYpF.js","assets/LoginView-3KlIzybG.css","assets/el-form-item-BWkJzdQ_.css","assets/el-button-DhOMi8yW.css","assets/el-checkbox-DIj50LEB.css","assets/el-input-tPmZxDKr.css","assets/RegisterView-Cc4EzstP.js","assets/RegisterView-DuOZK-r8.css","assets/MainLayout-CTBXUKmc.js","assets/el-tooltip-l0sNRNKZ.js","assets/MainLayout-DXKqG4x0.css","assets/el-scrollbar-naz6v7q5.css","assets/el-avatar-BmRr_O8d.css","assets/DashboardView-BPHK4nCT.js","assets/DashboardView-D5vpbzC4.css","assets/el-empty-D4ZqTl4F.css","assets/el-card-BMp62gu_.css","assets/el-col-Ds2mGN2S.css","assets/RecordListView-fjYwK9Oa.js","assets/RecordListView-DyrU0DA1.css","assets/el-loading-C5IeuJ3V.css","assets/el-overlay-uHqKdL1G.css","assets/el-upload-q8uObtwj.css","assets/el-progress-Dw9yTa91.css","assets/el-pagination-BNQcHhjS.css","assets/el-select-DC6_bRTH.css","assets/el-table-column-CKoPG0Y8.css","assets/el-popover-Dtxj3CUF.css","assets/el-date-picker-panel-BhfPqR_w.css","assets/RecordFormView-BUV9L87e.js","assets/RecordFormView-PsopNVSJ.css","assets/RecordTypeListView-DpxN6KNY.js","assets/RecordTypeListView-uC81n115.css","assets/FileListView-bXkRdWnh.js","assets/FileListView-BUy8jUDF.css","assets/ExportView-AwDNunuz.js","assets/ExportView-DcNElqx4.css","assets/UserListView-DM4cahzC.js","assets/UserListView-WmSj0RxZ.css","assets/RoleListView-DYhIo4nP.js","assets/RoleListView-Bx71aQqe.css","assets/SystemView-si3wiSHJ.js","assets/SystemView-BtUXfodM.css","assets/el-switch-B5lTGWdM.css","assets/ProfileView-DGNAicmI.js","assets/ProfileView-BtcbIAHm.css","assets/NotFoundView-DVzytpbw.js","assets/NotFoundView-FisTUZb6.css"])))=>i.map(i=>d[i]);
import{ax as b,ay as U,az as $,r as y,c as P,e as S,y as N,h as x,al as V,z as H,A as M,R as j,au as G,aA as q}from"./vendor-B2dHd6i_.js";import{E,i as W,a as z}from"./element-CUclIBtA.js";import{w as Y}from"./utils-xdQVjYpF.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function u(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=u(s);fetch(s.href,n)}})();var K={name:"zh-cn",el:{breadcrumb:{label:"面包屑"},colorpicker:{confirm:"确定",clear:"清空",defaultLabel:"颜色选择器",description:"当前颜色 {color}，按 Enter 键选择新颜色",alphaLabel:"选择透明度的值"},datepicker:{now:"此刻",today:"今天",cancel:"取消",clear:"清空",confirm:"确定",dateTablePrompt:"使用方向键与 Enter 键可选择日期",monthTablePrompt:"使用方向键与 Enter 键可选择月份",yearTablePrompt:"使用方向键与 Enter 键可选择年份",selectedDate:"已选日期",selectDate:"选择日期",selectTime:"选择时间",startDate:"开始日期",startTime:"开始时间",endDate:"结束日期",endTime:"结束时间",prevYear:"前一年",nextYear:"后一年",prevMonth:"上个月",nextMonth:"下个月",year:"年",month1:"1 月",month2:"2 月",month3:"3 月",month4:"4 月",month5:"5 月",month6:"6 月",month7:"7 月",month8:"8 月",month9:"9 月",month10:"10 月",month11:"11 月",month12:"12 月",weeks:{sun:"日",mon:"一",tue:"二",wed:"三",thu:"四",fri:"五",sat:"六"},weeksFull:{sun:"星期日",mon:"星期一",tue:"星期二",wed:"星期三",thu:"星期四",fri:"星期五",sat:"星期六"},months:{jan:"一月",feb:"二月",mar:"三月",apr:"四月",may:"五月",jun:"六月",jul:"七月",aug:"八月",sep:"九月",oct:"十月",nov:"十一月",dec:"十二月"}},inputNumber:{decrease:"减少数值",increase:"增加数值"},select:{loading:"加载中",noMatch:"无匹配数据",noData:"无数据",placeholder:"请选择"},dropdown:{toggleDropdown:"切换下拉选项"},mention:{loading:"加载中"},cascader:{noMatch:"无匹配数据",loading:"加载中",placeholder:"请选择",noData:"暂无数据"},pagination:{goto:"前往",pagesize:"条/页",total:"共 {total} 条",pageClassifier:"页",page:"页",prev:"上一页",next:"下一页",currentPage:"第 {pager} 页",prevPages:"向前 {pager} 页",nextPages:"向后 {pager} 页",deprecationWarning:"你使用了一些已被废弃的用法，请参考 el-pagination 的官方文档"},dialog:{close:"关闭此对话框"},drawer:{close:"关闭此对话框"},messagebox:{title:"提示",confirm:"确定",cancel:"取消",error:"输入的数据不合法!",close:"关闭此对话框"},upload:{deleteTip:"按 Delete 键可删除",delete:"删除",preview:"查看图片",continue:"继续上传"},slider:{defaultLabel:"滑块介于 {min} 至 {max}",defaultRangeStartLabel:"选择起始值",defaultRangeEndLabel:"选择结束值"},table:{emptyText:"暂无数据",confirmFilter:"筛选",resetFilter:"重置",clearFilter:"全部",sumText:"合计"},tour:{next:"下一步",previous:"上一步",finish:"结束导览",close:"关闭此对话框"},tree:{emptyText:"暂无数据"},transfer:{noMatch:"无匹配数据",noData:"无数据",titles:["列表 1","列表 2"],filterPlaceholder:"请输入搜索内容",noCheckedFormat:"共 {total} 项",hasCheckedFormat:"已选 {checked}/{total} 项"},image:{error:"加载失败"},pageHeader:{title:"返回"},popconfirm:{confirmButtonText:"确定",cancelButtonText:"取消"},carousel:{leftArrow:"上一张幻灯片",rightArrow:"下一张幻灯片",indicator:"幻灯片切换至索引 {index}"}}};const L={BASE_URL:"http://192.168.100.15:8080",VERSION:"/api/v1",TIMEOUT:1e4},h={AUTH:{LOGIN:"/auth/login",REGISTER:"/auth/register",REFRESH:"/auth/refresh",LOGOUT:"/auth/logout",PROFILE:"/users/profile",CHANGE_PASSWORD:"/users/password"},RECORDS:{LIST:"/records",CREATE:"/records",UPDATE:e=>`/records/${e}`,DELETE:e=>`/records/${e}`,DETAIL:e=>`/records/${e}`,BATCH:"/records/batch",IMPORT:"/records/import",BY_TYPE:e=>`/records/type/${e}`},RECORD_TYPES:{LIST:"/record-types",CREATE:"/record-types",UPDATE:e=>`/record-types/${e}`,DELETE:e=>`/record-types/${e}`,DETAIL:e=>`/record-types/${e}`},FILES:{UPLOAD:"/files/upload",LIST:"/files",DOWNLOAD:e=>`/files/${e}`,DELETE:e=>`/files/${e}`,INFO:e=>`/files/${e}/info`,OCR:"/files/ocr"},EXPORT:{TEMPLATES:"/export/templates",RECORDS:"/export/records",FILES:"/export/files",DOWNLOAD:e=>`/export/files/${e}/download`},PERMISSIONS:{CHECK:"/permissions/check",USER:e=>`/permissions/user/${e}`,LIST:"/permissions"},ROLES:{LIST:"/roles",CREATE:"/roles",UPDATE:e=>`/roles/${e}`,DELETE:e=>`/roles/${e}`,PERMISSIONS:e=>`/roles/${e}/permissions`},SYSTEM:{HEALTH:"/system/health",CONFIG:"/config",ANNOUNCEMENTS:"/announcements"}},J="modulepreload",X=function(e){return"/"+e},I={},c=function(r,u,i){let s=Promise.resolve();if(u&&u.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.allSettled(u.map(m=>{if(m=X(m),m in I)return;I[m]=!0;const p=m.endsWith(".css"),F=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${F}`))return;const d=document.createElement("link");if(d.rel=p?"stylesheet":J,p||(d.as="script"),d.crossOrigin="",d.href=m,l&&d.setAttribute("nonce",l),document.head.appendChild(d),p)return new Promise((v,R)=>{d.addEventListener("load",v),d.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${m}`)))})}))}function n(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return s.then(a=>{for(const l of a||[])l.status==="rejected"&&n(l.reason);return r().catch(n)})},Q=[{path:"/login",name:"Login",component:()=>c(()=>import("./LoginView-CKwenYqG.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])),meta:{title:"登录",hidden:!0}},{path:"/register",name:"Register",component:()=>c(()=>import("./RegisterView-Cc4EzstP.js"),__vite__mapDeps([11,1,2,3,4,5,12,7,8,9,10])),meta:{title:"注册",hidden:!0}},{path:"/",name:"Layout",component:()=>c(()=>import("./MainLayout-CTBXUKmc.js"),__vite__mapDeps([13,1,2,14,3,4,5,15,8,16,17])),redirect:"/dashboard",children:[{path:"dashboard",name:"Dashboard",component:()=>c(()=>import("./DashboardView-BPHK4nCT.js"),__vite__mapDeps([18,1,2,3,4,5,19,20,21,22])),meta:{title:"仪表板",icon:"Dashboard"}},{path:"records",name:"Records",component:()=>c(()=>import("./RecordListView-fjYwK9Oa.js"),__vite__mapDeps([23,1,2,14,3,4,5,24,25,26,27,28,29,21,30,16,10,22,31,9,32,8,7,33])),meta:{title:"记录管理",icon:"Document",permission:"records:read"}},{path:"records/create",name:"RecordCreate",component:()=>c(()=>import("./RecordFormView-BUV9L87e.js"),__vite__mapDeps([34,1,2,3,4,5,35,26,21,7,27,28,33,10,16,8,22,30])),meta:{title:"创建记录",hidden:!0,permission:"records:write"}},{path:"records/:id/edit",name:"RecordEdit",component:()=>c(()=>import("./RecordFormView-BUV9L87e.js"),__vite__mapDeps([34,1,2,3,4,5,35,26,21,7,27,28,33,10,16,8,22,30])),meta:{title:"编辑记录",hidden:!0,permission:"records:write"}},{path:"record-types",name:"RecordTypes",component:()=>c(()=>import("./RecordTypeListView-DpxN6KNY.js"),__vite__mapDeps([36,1,2,14,4,3,5,37,25,21,29,30,16,10,31,9,7,8])),meta:{title:"记录类型",icon:"Collection",permission:"system:admin"}},{path:"files",name:"Files",component:()=>c(()=>import("./FileListView-bXkRdWnh.js"),__vite__mapDeps([38,1,2,14,3,4,5,39,25,26,29,21,30,16,10,31,9,32,8,27,28])),meta:{title:"文件管理",icon:"Folder",permission:"files:read"}},{path:"export",name:"Export",component:()=>c(()=>import("./ExportView-AwDNunuz.js"),__vite__mapDeps([40,1,2,14,4,3,5,41,31,9,16,21,26,7,30,10,32,8,29,22,28,20,33])),meta:{title:"数据导出",icon:"Download",permission:"records:read"}},{path:"users",name:"Users",component:()=>c(()=>import("./UserListView-DM4cahzC.js"),__vite__mapDeps([42,1,2,14,4,3,5,43,25,21,29,30,16,10,31,9,7,8])),meta:{title:"用户管理",icon:"User",permission:"users:read"}},{path:"roles",name:"Roles",component:()=>c(()=>import("./RoleListView-DYhIo4nP.js"),__vite__mapDeps([44,1,2,14,4,3,5,45,25,21,29,30,16,10,31,9,7,8])),meta:{title:"角色管理",icon:"UserFilled",permission:"system:admin"}},{path:"system",name:"System",component:()=>c(()=>import("./SystemView-si3wiSHJ.js"),__vite__mapDeps([46,1,2,14,4,3,5,47,25,31,9,16,21,22,28,7,8,48,10])),meta:{title:"系统管理",icon:"Setting",permission:"system:admin"}},{path:"profile",name:"Profile",component:()=>c(()=>import("./ProfileView-DGNAicmI.js"),__vite__mapDeps([49,1,2,4,3,5,50,22,48,7,8,27,28,10,21,17])),meta:{title:"个人资料",hidden:!0}}]},{path:"/:pathMatch(.*)*",name:"NotFound",component:()=>c(()=>import("./NotFoundView-DVzytpbw.js"),__vite__mapDeps([51,1,2,3,4,5,52,8])),meta:{title:"页面不存在",hidden:!0}}],O=b({history:U(),routes:Q});O.beforeEach(async(e,r,u)=>{var n,a;const i=A();if((n=e.meta)!=null&&n.title&&(document.title=`${e.meta.title} - 信息管理系统`),["/login","/register"].includes(e.path)){i.isAuthenticated?u("/"):u();return}if(!i.isAuthenticated){u("/login");return}if((a=e.meta)!=null&&a.permission){const l=e.meta.permission,[m,p,F="all"]=l.split(":");if(!i.hasPermission(m,p,F)){E.error("没有权限访问该页面"),u("/");return}}u()});const D=Y.create({baseURL:`${L.BASE_URL}${L.VERSION}`,timeout:L.TIMEOUT,headers:{"Content-Type":"application/json"}});D.interceptors.request.use(e=>{const r=A();return r.token&&(e.headers={...e.headers,Authorization:`Bearer ${r.token}`}),e},e=>(console.error("Request error:",e),Promise.reject(e)));D.interceptors.response.use(e=>{const{data:r,status:u}=e;return u===200||u===201?r:(E.error(r.message||"请求失败"),Promise.reject(new Error(r.message||"请求失败")))},async e=>{const{response:r,message:u}=e,i=A();if(r){const{status:s,data:n}=r;switch(s){case 401:E.error("登录已过期，请重新登录"),i.logout(),O.push("/login");break;case 403:E.error("没有权限访问该资源");break;case 404:E.error("请求的资源不存在");break;case 422:if(n.errors){const a=Object.values(n.errors).flat();E.error(a.join(", "))}else E.error(n.message||"请求参数错误");break;case 429:E.error("请求过于频繁，请稍后再试");break;case 500:E.error("服务器内部错误");break;default:E.error(n.message||`请求失败 (${s})`)}}else u.includes("timeout")?E.error("请求超时，请检查网络连接"):u.includes("Network Error")?E.error("网络连接失败，请检查网络"):E.error("请求失败，请稍后重试");return Promise.reject(e)});const f={get(e,r){return D.get(e,r)},post(e,r,u){return D.post(e,r,u)},put(e,r,u){return D.put(e,r,u)},delete(e,r){return D.delete(e,r)},upload(e,r,u){return D.post(e,r,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:i=>{if(u&&i.total){const s=Math.round(i.loaded*100/i.total);u(s)}}})}},A=$("auth",()=>{const e=y(localStorage.getItem("token")||""),r=y(localStorage.getItem("refreshToken")||""),u=y(null),i=y(!1),s=P(()=>!!e.value&&!!u.value),n=P(()=>{var t;return((t=u.value)==null?void 0:t.roles)||[]}),a=P(()=>{const t=[];return n.value.forEach(o=>{o.permissions.forEach(_=>{const T=`${_.resource}:${_.action}:${_.scope}`;t.includes(T)||t.push(T)})}),t}),l=(t,o,_="all")=>{if(!s.value)return!1;const T=`${t}:${o}:${_}`,k=`${t}:${o}:own`;return a.value.includes(T)||a.value.includes(k)},m=t=>n.value.some(o=>o.name===t),p=async t=>{try{i.value=!0;const o=await f.post(h.AUTH.LOGIN,t);e.value=o.token,r.value=o.refreshToken,u.value=o.user,localStorage.setItem("token",o.token),localStorage.setItem("refreshToken",o.refreshToken),localStorage.setItem("user",JSON.stringify(o.user))}catch(o){throw console.error("Login failed:",o),o}finally{i.value=!1}},F=async t=>{try{i.value=!0,await f.post(h.AUTH.REGISTER,t)}catch(o){throw console.error("Register failed:",o),o}finally{i.value=!1}},d=async()=>{try{const t=await f.post(h.AUTH.REFRESH,{refreshToken:r.value});e.value=t.token,localStorage.setItem("token",t.token),t.refreshToken&&(r.value=t.refreshToken,localStorage.setItem("refreshToken",t.refreshToken))}catch(t){throw console.error("Token refresh failed:",t),B(),t}},v=async()=>{try{const t=await f.get(h.AUTH.PROFILE);u.value=t,localStorage.setItem("user",JSON.stringify(t))}catch(t){throw console.error("Fetch user profile failed:",t),t}},R=async t=>{try{const o=await f.put(h.AUTH.PROFILE,t);u.value=o,localStorage.setItem("user",JSON.stringify(o))}catch(o){throw console.error("Update profile failed:",o),o}},C=async t=>{try{await f.put(h.AUTH.CHANGE_PASSWORD,t)}catch(o){throw console.error("Change password failed:",o),o}},B=async()=>{try{e.value&&await f.post(h.AUTH.LOGOUT)}catch(t){console.error("Logout request failed:",t)}finally{e.value="",r.value="",u.value=null,localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user")}},w=()=>{const t=localStorage.getItem("user");if(t&&e.value)try{u.value=JSON.parse(t)}catch(o){console.error("Failed to parse saved user data:",o),B()}};return{token:S(e),refreshToken:S(r),user:S(u),isLoading:S(i),isAuthenticated:s,userRoles:n,userPermissions:a,hasPermission:l,hasRole:m,login:p,register:F,refreshAccessToken:d,fetchUserProfile:v,updateProfile:R,changePassword:C,logout:B,initAuth:w}}),Z={id:"app"},ee=N({__name:"App",setup(e){const r=A();return x(()=>{r.initAuth()}),(u,i)=>{const s=V("router-view");return M(),H("div",Z,[j(s)])}}}),g=G(ee),te=q();g.use(te);g.use(W,{locale:K});for(const[e,r]of Object.entries(z))g.component(e,r);g.use(O);const re=A();re.initAuth();g.mount("#app");export{h as A,f as h,A as u};
//# sourceMappingURL=index-Co-C_Vux.js.map
