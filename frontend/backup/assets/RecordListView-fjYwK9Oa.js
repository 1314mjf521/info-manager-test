import{_ as Ie}from"./_plugin-vue_export-helper-BJA4NJ9J.js";/* empty css                   *//* empty css                   *//* empty css                  *//* empty css                    *//* empty css                      *//* empty css                *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css               *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                   *//* empty css                  *//* empty css                     *//* empty css                             */import{y as Le,r as w,l as X,c as q,h as Ye,z as V,R as t,K as $e,J as o,I as u,B as d,a4 as Be,Q as Z,a6 as ee,O as s,al as h,L as b,u as te,P as m,aB as Ue,A as i,W as Oe}from"./vendor-B2dHd6i_.js";import{u as Ae,A as S,h as M}from"./index-Co-C_Vux.js";import{z as Fe,H as Ne,I as je,E as y,b as He,c as Ke,d as Ge,J as Je,K as Qe,L as We,f as Xe,l as qe,n as Ze,M as et,N as tt,O as ot,F as lt,P as at,y as st,Q as nt,R as rt,G as oe,A as dt}from"./element-CUclIBtA.js";import"./utils-xdQVjYpF.js";const it={class:"record-list"},ct={class:"action-bar"},pt={class:"action-left"},ut={class:"action-right"},mt={key:1,class:"card-view"},_t={class:"card-header"},ft={class:"card-content"},yt={class:"record-type"},vt={class:"record-time"},gt={class:"record-creator"},kt={class:"pagination-wrapper"},ht=Le({__name:"RecordListView",setup(Ct){const P=Ue(),_=Ae(),T=w(!1),E=w("list"),I=w([]),U=w([]),L=w([]),R=w(!1),n=X({keyword:"",type:"",status:"",dateRange:null}),c=X({page:1,pageSize:20,total:0}),le=q(()=>S.RECORDS.IMPORT),ae=q(()=>({Authorization:`Bearer ${_.token}`})),O=a=>oe(a).format("YYYY-MM-DD HH:mm"),A=a=>({draft:"info",published:"success",archived:"warning"})[a]||"info",F=a=>({draft:"草稿",published:"已发布",archived:"已归档"})[a]||a,N=a=>{var e;return _.hasPermission("records","write")&&(_.hasPermission("records","write","all")||a.createdBy===((e=_.user)==null?void 0:e.id))},j=a=>{var e;return _.hasPermission("records","delete")&&(_.hasPermission("records","delete","all")||a.createdBy===((e=_.user)==null?void 0:e.id))},v=async()=>{try{T.value=!0;const a={page:c.page,pageSize:c.pageSize};n.keyword&&(a.keyword=n.keyword),n.type&&(a.type=n.type),n.status&&(a.status=n.status),n.dateRange&&(a.startDate=n.dateRange[0],a.endDate=n.dateRange[1]);const e=await M.get(S.RECORDS.LIST,{params:a});I.value=e.items,c.total=e.total}catch(a){console.error("Failed to load records:",a),y.error("加载记录列表失败")}finally{T.value=!1}},se=async()=>{try{const a=await M.get(S.RECORD_TYPES.LIST);U.value=a}catch(a){console.error("Failed to load record types:",a)}},H=()=>{c.page=1,v()},ne=()=>{Object.assign(n,{keyword:"",type:"",status:"",dateRange:null}),c.page=1,v()},re=a=>{c.page=a,v()},de=a=>{c.pageSize=a,c.page=1,v()},ie=a=>{L.value=a},ce=()=>{P.push("/records/create")},z=a=>{P.push(`/records/${a.id}`)},K=a=>{P.push(`/records/${a.id}/edit`)},G=async a=>{try{await M.delete(S.RECORDS.DELETE(a.id)),y.success("删除成功"),v()}catch(e){console.error("Failed to delete record:",e),y.error("删除失败")}},pe=()=>{R.value=!0},ue=async()=>{try{const a=L.value.map(D=>D.id),e=await M.post(S.EXPORT.RECORDS,{recordIds:a,format:"excel"},{responseType:"blob"}),x=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),g=window.URL.createObjectURL(x),k=document.createElement("a");k.href=g,k.download=`records_${oe().format("YYYY-MM-DD")}.xlsx`,k.click(),window.URL.revokeObjectURL(g),y.success("导出成功")}catch(a){console.error("Failed to export records:",a),y.error("导出失败")}},me=a=>{const e=["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv"].includes(a.type),x=a.size/1024/1024<10;return e?x?!0:(y.error("文件大小不能超过 10MB"),!1):(y.error("只能上传 Excel 或 CSV 文件"),!1)},_e=a=>{y.success(`导入成功，共导入 ${a.count} 条记录`),R.value=!1,v()},fe=a=>{console.error("Import failed:",a),y.error("导入失败")},ye=()=>{const a=document.createElement("a");a.href="/templates/record_import_template.xlsx",a.download="record_import_template.xlsx",a.click()};return Ye(()=>{v(),se()}),(a,e)=>{const x=Ge,g=Ke,k=Qe,D=Je,ve=We,ge=h("Search"),f=qe,r=Xe,J=h("Refresh"),ke=He,he=h("Plus"),Ce=h("Upload"),we=h("Download"),Y=Ze,be=h("List"),Ee=h("Grid"),$=Fe,C=tt,Re=ot,B=lt,Q=at,xe=et,Se=dt,ze=st,De=nt,Ve=h("upload-filled"),Me=rt,Pe=je,Te=Ne;return i(),V("div",it,[t($,{class:"search-card",shadow:"never"},{default:o(()=>[t(ke,{model:n,inline:"",class:"search-form"},{default:o(()=>[t(g,{label:"关键词"},{default:o(()=>[t(x,{modelValue:n.keyword,"onUpdate:modelValue":e[0]||(e[0]=l=>n.keyword=l),placeholder:"搜索标题或内容",clearable:"",onKeyup:Be(H,["enter"])},null,8,["modelValue"])]),_:1}),t(g,{label:"记录类型"},{default:o(()=>[t(D,{modelValue:n.type,"onUpdate:modelValue":e[1]||(e[1]=l=>n.type=l),placeholder:"选择记录类型",clearable:""},{default:o(()=>[(i(!0),V(Z,null,ee(U.value,l=>(i(),u(k,{key:l.id,label:l.name,value:l.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(g,{label:"状态"},{default:o(()=>[t(D,{modelValue:n.status,"onUpdate:modelValue":e[2]||(e[2]=l=>n.status=l),placeholder:"选择状态",clearable:""},{default:o(()=>[t(k,{label:"草稿",value:"draft"}),t(k,{label:"已发布",value:"published"}),t(k,{label:"已归档",value:"archived"})]),_:1},8,["modelValue"])]),_:1}),t(g,{label:"创建时间"},{default:o(()=>[t(ve,{modelValue:n.dateRange,"onUpdate:modelValue":e[3]||(e[3]=l=>n.dateRange=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(g,null,{default:o(()=>[t(r,{type:"primary",onClick:H},{default:o(()=>[t(f,null,{default:o(()=>[t(ge)]),_:1}),e[11]||(e[11]=s(" 搜索 ",-1))]),_:1}),t(r,{onClick:ne},{default:o(()=>[t(f,null,{default:o(()=>[t(J)]),_:1}),e[12]||(e[12]=s(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"]),d("div",ct,[d("div",pt,[te(_).hasPermission("records","write")?(i(),u(r,{key:0,type:"primary",onClick:ce},{default:o(()=>[t(f,null,{default:o(()=>[t(he)]),_:1}),e[13]||(e[13]=s(" 新建记录 ",-1))]),_:1})):b("",!0),te(_).hasPermission("records","write")?(i(),u(r,{key:1,type:"success",onClick:pe},{default:o(()=>[t(f,null,{default:o(()=>[t(Ce)]),_:1}),e[14]||(e[14]=s(" 批量导入 ",-1))]),_:1})):b("",!0),t(r,{type:"warning",onClick:ue,disabled:L.value.length===0},{default:o(()=>[t(f,null,{default:o(()=>[t(we)]),_:1}),e[15]||(e[15]=s(" 批量导出 ",-1))]),_:1},8,["disabled"])]),d("div",ut,[t(Y,{content:"刷新"},{default:o(()=>[t(r,{circle:"",onClick:v},{default:o(()=>[t(f,null,{default:o(()=>[t(J)]),_:1})]),_:1})]),_:1}),t(Y,{content:"列表视图"},{default:o(()=>[t(r,{circle:"",type:E.value==="list"?"primary":"default",onClick:e[4]||(e[4]=l=>E.value="list")},{default:o(()=>[t(f,null,{default:o(()=>[t(be)]),_:1})]),_:1},8,["type"])]),_:1}),t(Y,{content:"卡片视图"},{default:o(()=>[t(r,{circle:"",type:E.value==="card"?"primary":"default",onClick:e[5]||(e[5]=l=>E.value="card")},{default:o(()=>[t(f,null,{default:o(()=>[t(Ee)]),_:1})]),_:1},8,["type"])]),_:1})])])]),_:1}),$e((i(),u($,{class:"list-card"},{default:o(()=>[E.value==="list"?(i(),u(xe,{key:0,data:I.value,onSelectionChange:ie,stripe:"",style:{width:"100%"}},{default:o(()=>[t(C,{type:"selection",width:"55"}),t(C,{prop:"title",label:"标题","min-width":"200"},{default:o(({row:l})=>[t(Re,{type:"primary",onClick:p=>z(l),underline:!1},{default:o(()=>[s(m(l.title),1)]),_:2},1032,["onClick"])]),_:1}),t(C,{prop:"type",label:"类型",width:"120"},{default:o(({row:l})=>[t(B,{size:"small"},{default:o(()=>[s(m(l.type),1)]),_:2},1024)]),_:1}),t(C,{prop:"status",label:"状态",width:"100"},{default:o(({row:l})=>[t(B,{type:A(l.status),size:"small"},{default:o(()=>[s(m(F(l.status)),1)]),_:2},1032,["type"])]),_:1}),t(C,{prop:"creator",label:"创建者",width:"120"},{default:o(({row:l})=>{var p;return[s(m(((p=l.creator)==null?void 0:p.username)||"未知"),1)]}),_:1}),t(C,{prop:"createdAt",label:"创建时间",width:"180"},{default:o(({row:l})=>[s(m(O(l.createdAt)),1)]),_:1}),t(C,{label:"操作",width:"200",fixed:"right"},{default:o(({row:l})=>[t(r,{type:"primary",size:"small",onClick:p=>z(l)},{default:o(()=>[...e[16]||(e[16]=[s(" 查看 ",-1)])]),_:1},8,["onClick"]),N(l)?(i(),u(r,{key:0,type:"warning",size:"small",onClick:p=>K(l)},{default:o(()=>[...e[17]||(e[17]=[s(" 编辑 ",-1)])]),_:1},8,["onClick"])):b("",!0),j(l)?(i(),u(Q,{key:1,title:"确定要删除这条记录吗？",onConfirm:p=>G(l)},{reference:o(()=>[t(r,{type:"danger",size:"small"},{default:o(()=>[...e[18]||(e[18]=[s(" 删除 ",-1)])]),_:1})]),_:1},8,["onConfirm"])):b("",!0)]),_:1})]),_:1},8,["data"])):(i(),V("div",mt,[t(ze,{gutter:20},{default:o(()=>[(i(!0),V(Z,null,ee(I.value,l=>(i(),u(Se,{xs:24,sm:12,md:8,lg:6,key:l.id,class:"record-card-col"},{default:o(()=>[t($,{class:"record-card",shadow:"hover",onClick:p=>z(l)},{default:o(()=>{var p;return[d("div",_t,[d("h3",null,m(l.title),1),t(B,{type:A(l.status),size:"small"},{default:o(()=>[s(m(F(l.status)),1)]),_:2},1032,["type"])]),d("div",ft,[d("p",yt,m(l.type),1),d("p",vt,m(O(l.createdAt)),1),d("p",gt,"创建者："+m(((p=l.creator)==null?void 0:p.username)||"未知"),1)]),d("div",{class:"card-actions",onClick:e[6]||(e[6]=Oe(()=>{},["stop"]))},[t(r,{size:"small",onClick:W=>z(l)},{default:o(()=>[...e[19]||(e[19]=[s(" 查看 ",-1)])]),_:1},8,["onClick"]),N(l)?(i(),u(r,{key:0,size:"small",type:"warning",onClick:W=>K(l)},{default:o(()=>[...e[20]||(e[20]=[s(" 编辑 ",-1)])]),_:1},8,["onClick"])):b("",!0),j(l)?(i(),u(Q,{key:1,title:"确定要删除这条记录吗？",onConfirm:W=>G(l)},{reference:o(()=>[t(r,{size:"small",type:"danger"},{default:o(()=>[...e[21]||(e[21]=[s(" 删除 ",-1)])]),_:1})]),_:1},8,["onConfirm"])):b("",!0)])]}),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})])),d("div",kt,[t(De,{"current-page":c.page,"onUpdate:currentPage":e[7]||(e[7]=l=>c.page=l),"page-size":c.pageSize,"onUpdate:pageSize":e[8]||(e[8]=l=>c.pageSize=l),"page-sizes":[10,20,50,100],total:c.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:de,onCurrentChange:re},null,8,["current-page","page-size","total"])])]),_:1})),[[Te,T.value]]),t(Pe,{modelValue:R.value,"onUpdate:modelValue":e[10]||(e[10]=l=>R.value=l),title:"批量导入记录",width:"600px"},{footer:o(()=>[t(r,{onClick:e[9]||(e[9]=l=>R.value=!1)},{default:o(()=>[...e[24]||(e[24]=[s("取消",-1)])]),_:1}),t(r,{type:"primary",onClick:ye},{default:o(()=>[...e[25]||(e[25]=[s(" 下载模板 ",-1)])]),_:1})]),default:o(()=>[t(Me,{ref:"uploadRef",action:le.value,headers:ae.value,"on-success":_e,"on-error":fe,"before-upload":me,drag:"",accept:".xlsx,.xls,.csv"},{tip:o(()=>[...e[22]||(e[22]=[d("div",{class:"el-upload__tip"}," 只能上传 xlsx/xls/csv 文件，且不超过 10MB ",-1)])]),default:o(()=>[t(f,{class:"el-icon--upload"},{default:o(()=>[t(Ve)]),_:1}),e[23]||(e[23]=d("div",{class:"el-upload__text"},[s(" 将文件拖到此处，或"),d("em",null,"点击上传")],-1))]),_:1},8,["action","headers"])]),_:1},8,["modelValue"])])}}}),jt=Ie(ht,[["__scopeId","data-v-a5c95c46"]]);export{jt as default};
//# sourceMappingURL=RecordListView-fjYwK9Oa.js.map
