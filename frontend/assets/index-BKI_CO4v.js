const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LoginView-BXAUgJxK.js","assets/vendor-CjKLjCsc.js","assets/element-DWu_pZyV.js","assets/utils-DtZYWtiR.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/LoginView-Cxcgowgw.css","assets/el-button-mjPzPNV5.css","assets/el-input-EA16acr3.css","assets/RegisterView-qm1z146g.js","assets/RegisterView-DA46oS2R.css","assets/MainLayout-gRL8Usah.js","assets/MainLayout-CEcIcyb4.css","assets/el-tooltip-naz6v7q5.css","assets/DashboardView-uYmYFB5Z.js","assets/DashboardView-ByKFD4l6.css","assets/el-card-8WYvJ2YF.css","assets/RecordListView-CCHAUAXq.js","assets/RecordListView-CzOyj4UR.css","assets/RecordFormView-BKhaAvVT.js","assets/RecordFormView-BTJDg786.css","assets/RecordTypeListView-Y1mFYO9x.js","assets/RecordTypeListView-u8JPb6hF.css","assets/FileListView-DO8fESGO.js","assets/FileListView-CSgVFL7w.css","assets/ExportView-BBlZYcm9.js","assets/ExportView-CCJTV2fR.css","assets/UserListView-Bz3IaJr_.js","assets/UserListView-Gdg2-XHo.css","assets/RoleListView-DESUrHA6.js","assets/RoleListView-Bglb8RXZ.css","assets/SystemView-CyR6cLeR.js","assets/SystemView-ChvaS6za.css","assets/ProfileView-Btlz-6hg.js","assets/ProfileView-CFK-IPIy.css","assets/NotFoundView-jw9iczpm.js","assets/NotFoundView-BnYzLzSj.css"])))=>i.map(i=>d[i]);
import{ax as b,ay as U,az as $,r as y,c as P,e as S,y as N,h as x,al as M,z as V,A as H,R as j,au as G,aA as q}from"./vendor-CjKLjCsc.js";import{E,i as W,a as z}from"./element-DWu_pZyV.js";import{w as Y}from"./utils-DtZYWtiR.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const t of a.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&i(t)}).observe(document,{childList:!0,subtree:!0});function o(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=o(n);fetch(n.href,a)}})();var K={name:"zh-cn",el:{breadcrumb:{label:"面包屑"},colorpicker:{confirm:"确定",clear:"清空",defaultLabel:"颜色选择器",description:"当前颜色 {color}，按 Enter 键选择新颜色",alphaLabel:"选择透明度的值"},datepicker:{now:"此刻",today:"今天",cancel:"取消",clear:"清空",confirm:"确定",dateTablePrompt:"使用方向键与 Enter 键可选择日期",monthTablePrompt:"使用方向键与 Enter 键可选择月份",yearTablePrompt:"使用方向键与 Enter 键可选择年份",selectedDate:"已选日期",selectDate:"选择日期",selectTime:"选择时间",startDate:"开始日期",startTime:"开始时间",endDate:"结束日期",endTime:"结束时间",prevYear:"前一年",nextYear:"后一年",prevMonth:"上个月",nextMonth:"下个月",year:"年",month1:"1 月",month2:"2 月",month3:"3 月",month4:"4 月",month5:"5 月",month6:"6 月",month7:"7 月",month8:"8 月",month9:"9 月",month10:"10 月",month11:"11 月",month12:"12 月",weeks:{sun:"日",mon:"一",tue:"二",wed:"三",thu:"四",fri:"五",sat:"六"},weeksFull:{sun:"星期日",mon:"星期一",tue:"星期二",wed:"星期三",thu:"星期四",fri:"星期五",sat:"星期六"},months:{jan:"一月",feb:"二月",mar:"三月",apr:"四月",may:"五月",jun:"六月",jul:"七月",aug:"八月",sep:"九月",oct:"十月",nov:"十一月",dec:"十二月"}},inputNumber:{decrease:"减少数值",increase:"增加数值"},select:{loading:"加载中",noMatch:"无匹配数据",noData:"无数据",placeholder:"请选择"},dropdown:{toggleDropdown:"切换下拉选项"},mention:{loading:"加载中"},cascader:{noMatch:"无匹配数据",loading:"加载中",placeholder:"请选择",noData:"暂无数据"},pagination:{goto:"前往",pagesize:"条/页",total:"共 {total} 条",pageClassifier:"页",page:"页",prev:"上一页",next:"下一页",currentPage:"第 {pager} 页",prevPages:"向前 {pager} 页",nextPages:"向后 {pager} 页",deprecationWarning:"你使用了一些已被废弃的用法，请参考 el-pagination 的官方文档"},dialog:{close:"关闭此对话框"},drawer:{close:"关闭此对话框"},messagebox:{title:"提示",confirm:"确定",cancel:"取消",error:"输入的数据不合法!",close:"关闭此对话框"},upload:{deleteTip:"按 Delete 键可删除",delete:"删除",preview:"查看图片",continue:"继续上传"},slider:{defaultLabel:"滑块介于 {min} 至 {max}",defaultRangeStartLabel:"选择起始值",defaultRangeEndLabel:"选择结束值"},table:{emptyText:"暂无数据",confirmFilter:"筛选",resetFilter:"重置",clearFilter:"全部",sumText:"合计"},tour:{next:"下一步",previous:"上一步",finish:"结束导览",close:"关闭此对话框"},tree:{emptyText:"暂无数据"},transfer:{noMatch:"无匹配数据",noData:"无数据",titles:["列表 1","列表 2"],filterPlaceholder:"请输入搜索内容",noCheckedFormat:"共 {total} 项",hasCheckedFormat:"已选 {checked}/{total} 项"},image:{error:"加载失败"},pageHeader:{title:"返回"},popconfirm:{confirmButtonText:"确定",cancelButtonText:"取消"},carousel:{leftArrow:"上一张幻灯片",rightArrow:"下一张幻灯片",indicator:"幻灯片切换至索引 {index}"}}};const I={BASE_URL:"http://localhost:8080",VERSION:"/api/v1",TIMEOUT:1e4,PAGE_SIZE:20,MAX_FILE_SIZE:10},h={AUTH:{LOGIN:"/auth/login",REGISTER:"/auth/register",REFRESH:"/auth/refresh",LOGOUT:"/auth/logout",PROFILE:"/users/profile",CHANGE_PASSWORD:"/users/password"},RECORDS:{LIST:"/records",CREATE:"/records",UPDATE:e=>`/records/${e}`,DELETE:e=>`/records/${e}`,DETAIL:e=>`/records/${e}`,BATCH:"/records/batch",IMPORT:"/records/import",BY_TYPE:e=>`/records/type/${e}`},RECORD_TYPES:{LIST:"/record-types",CREATE:"/record-types",UPDATE:e=>`/record-types/${e}`,DELETE:e=>`/record-types/${e}`,DETAIL:e=>`/record-types/${e}`},FILES:{UPLOAD:"/files/upload",LIST:"/files",DOWNLOAD:e=>`/files/${e}`,DELETE:e=>`/files/${e}`,INFO:e=>`/files/${e}/info`,OCR:"/files/ocr"},EXPORT:{TEMPLATES:"/export/templates",RECORDS:"/export/records",FILES:"/export/files",DOWNLOAD:e=>`/export/files/${e}/download`},PERMISSIONS:{CHECK:"/permissions/check",USER:e=>`/permissions/user/${e}`,LIST:"/permissions"},ROLES:{LIST:"/roles",CREATE:"/roles",UPDATE:e=>`/roles/${e}`,DELETE:e=>`/roles/${e}`,PERMISSIONS:e=>`/roles/${e}/permissions`},SYSTEM:{HEALTH:"/system/health",CONFIG:"/config",ANNOUNCEMENTS:"/announcements"}},J="modulepreload",X=function(e){return"/"+e},O={},c=function(u,o,i){let n=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),l=(t==null?void 0:t.nonce)||(t==null?void 0:t.getAttribute("nonce"));n=Promise.allSettled(o.map(m=>{if(m=X(m),m in O)return;O[m]=!0;const p=m.endsWith(".css"),F=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${F}`))return;const d=document.createElement("link");if(d.rel=p?"stylesheet":J,p||(d.as="script"),d.crossOrigin="",d.href=m,l&&d.setAttribute("nonce",l),document.head.appendChild(d),p)return new Promise((v,R)=>{d.addEventListener("load",v),d.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${m}`)))})}))}function a(t){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=t,window.dispatchEvent(l),!l.defaultPrevented)throw t}return n.then(t=>{for(const l of t||[])l.status==="rejected"&&a(l.reason);return u().catch(a)})},Z=[{path:"/login",name:"Login",component:()=>c(()=>import("./LoginView-BXAUgJxK.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])),meta:{title:"登录",hidden:!0}},{path:"/register",name:"Register",component:()=>c(()=>import("./RegisterView-qm1z146g.js"),__vite__mapDeps([8,1,2,3,4,9,6,7])),meta:{title:"注册",hidden:!0}},{path:"/",name:"Layout",component:()=>c(()=>import("./MainLayout-gRL8Usah.js"),__vite__mapDeps([10,1,2,3,4,11,6,12])),redirect:"/dashboard",children:[{path:"dashboard",name:"Dashboard",component:()=>c(()=>import("./DashboardView-uYmYFB5Z.js"),__vite__mapDeps([13,2,1,3,4,14,6,15,12])),meta:{title:"仪表板",icon:"Dashboard"}},{path:"records",name:"Records",component:()=>c(()=>import("./RecordListView-CCHAUAXq.js"),__vite__mapDeps([16,1,2,3,4,17,6,15,12,7])),meta:{title:"记录管理",icon:"Document",permission:"records:read"}},{path:"records/create",name:"RecordCreate",component:()=>c(()=>import("./RecordFormView-BKhaAvVT.js"),__vite__mapDeps([18,1,4,19])),meta:{title:"创建记录",hidden:!0,permission:"records:write"}},{path:"records/:id/edit",name:"RecordEdit",component:()=>c(()=>import("./RecordFormView-BKhaAvVT.js"),__vite__mapDeps([18,1,4,19])),meta:{title:"编辑记录",hidden:!0,permission:"records:write"}},{path:"record-types",name:"RecordTypes",component:()=>c(()=>import("./RecordTypeListView-Y1mFYO9x.js"),__vite__mapDeps([20,1,4,21])),meta:{title:"记录类型",icon:"Collection",permission:"system:admin"}},{path:"files",name:"Files",component:()=>c(()=>import("./FileListView-DO8fESGO.js"),__vite__mapDeps([22,1,4,23])),meta:{title:"文件管理",icon:"Folder",permission:"files:read"}},{path:"export",name:"Export",component:()=>c(()=>import("./ExportView-BBlZYcm9.js"),__vite__mapDeps([24,1,4,25])),meta:{title:"数据导出",icon:"Download",permission:"records:read"}},{path:"users",name:"Users",component:()=>c(()=>import("./UserListView-Bz3IaJr_.js"),__vite__mapDeps([26,1,4,27])),meta:{title:"用户管理",icon:"User",permission:"users:read"}},{path:"roles",name:"Roles",component:()=>c(()=>import("./RoleListView-DESUrHA6.js"),__vite__mapDeps([28,1,4,29])),meta:{title:"角色管理",icon:"UserFilled",permission:"system:admin"}},{path:"system",name:"System",component:()=>c(()=>import("./SystemView-CyR6cLeR.js"),__vite__mapDeps([30,1,4,31])),meta:{title:"系统管理",icon:"Setting",permission:"system:admin"}},{path:"profile",name:"Profile",component:()=>c(()=>import("./ProfileView-Btlz-6hg.js"),__vite__mapDeps([32,1,4,33])),meta:{title:"个人资料",hidden:!0}}]},{path:"/:pathMatch(.*)*",name:"NotFound",component:()=>c(()=>import("./NotFoundView-jw9iczpm.js"),__vite__mapDeps([34,1,4,35])),meta:{title:"页面不存在",hidden:!0}}],L=b({history:U(),routes:Z});L.beforeEach(async(e,u,o)=>{var a,t;const i=A();if((a=e.meta)!=null&&a.title&&(document.title=`${e.meta.title} - 信息管理系统`),["/login","/register"].includes(e.path)){i.isAuthenticated?o("/"):o();return}if(!i.isAuthenticated){o("/login");return}if((t=e.meta)!=null&&t.permission){const l=e.meta.permission,[m,p,F="all"]=l.split(":");if(!i.hasPermission(m,p,F)){E.error("没有权限访问该页面"),o("/");return}}o()});const D=Y.create({baseURL:`${I.BASE_URL}${I.VERSION}`,timeout:I.TIMEOUT,headers:{"Content-Type":"application/json"}});D.interceptors.request.use(e=>{const u=A();return u.token&&(e.headers=e.headers||{},e.headers.Authorization=`Bearer ${u.token}`),e},e=>(console.error("Request error:",e),Promise.reject(e)));D.interceptors.response.use(e=>{const{data:u,status:o}=e;return o===200||o===201?u:(E.error(u.message||"请求失败"),Promise.reject(new Error(u.message||"请求失败")))},async e=>{const{response:u,message:o}=e,i=A();if(u){const{status:n,data:a}=u;let t="";switch(n){case 401:t="登录已过期，请重新登录",E.error(t),i.logout(),L.push("/login");break;case 403:t="没有权限访问该资源",E.error(t);break;case 404:t="请求的资源不存在",E.error(t);break;case 400:t=a.error||a.message||"请求参数错误",E.error(t);break;case 422:a.errors?(t=Object.values(a.errors).flat().join(", "),E.error(t)):(t=a.message||"请求参数错误",E.error(t));break;case 429:t="请求过于频繁，请稍后再试",E.error(t);break;case 500:t="服务器内部错误",E.error(t);break;default:t=a.message||`请求失败 (${n})`,E.error(t)}}else o.includes("timeout")?E.error("请求超时，请检查网络连接"):o.includes("Network Error")?E.error("网络连接失败，请检查网络"):E.error("请求失败，请稍后重试");return Promise.reject(e)});const f={get(e,u){return D.get(e,u)},post(e,u,o){return D.post(e,u,o)},put(e,u,o){return D.put(e,u,o)},delete(e,u){return D.delete(e,u)},upload(e,u,o){return D.post(e,u,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:i=>{if(o&&i.total){const n=Math.round(i.loaded*100/i.total);o(n)}}})}},A=$("auth",()=>{const e=y(localStorage.getItem("token")||""),u=y(localStorage.getItem("refreshToken")||""),o=y(null),i=y(!1),n=P(()=>!!e.value&&!!o.value),a=P(()=>{var r;return((r=o.value)==null?void 0:r.roles)||[]}),t=P(()=>{const r=[];return a.value.forEach(s=>{s.permissions.forEach(_=>{const T=`${_.resource}:${_.action}:${_.scope}`;r.includes(T)||r.push(T)})}),r}),l=(r,s,_="all")=>{if(!n.value)return!1;const T=`${r}:${s}:${_}`,k=`${r}:${s}:own`;return t.value.includes(T)||t.value.includes(k)},m=r=>a.value.some(s=>s.name===r),p=async r=>{try{i.value=!0;const s=await f.post(h.AUTH.LOGIN,r);e.value=s.token,u.value=s.refreshToken,o.value=s.user,localStorage.setItem("token",s.token),localStorage.setItem("refreshToken",s.refreshToken),localStorage.setItem("user",JSON.stringify(s.user))}catch(s){throw console.error("Login failed:",s),s}finally{i.value=!1}},F=async r=>{try{i.value=!0,await f.post(h.AUTH.REGISTER,r)}catch(s){throw console.error("Register failed:",s),s}finally{i.value=!1}},d=async()=>{try{const r=await f.post(h.AUTH.REFRESH,{refreshToken:u.value});e.value=r.token,localStorage.setItem("token",r.token),r.refreshToken&&(u.value=r.refreshToken,localStorage.setItem("refreshToken",r.refreshToken))}catch(r){throw console.error("Token refresh failed:",r),B(),r}},v=async()=>{try{const r=await f.get(h.AUTH.PROFILE);o.value=r,localStorage.setItem("user",JSON.stringify(r))}catch(r){throw console.error("Fetch user profile failed:",r),r}},R=async r=>{try{const s=await f.put(h.AUTH.PROFILE,r);o.value=s,localStorage.setItem("user",JSON.stringify(s))}catch(s){throw console.error("Update profile failed:",s),s}},C=async r=>{try{await f.put(h.AUTH.CHANGE_PASSWORD,r)}catch(s){throw console.error("Change password failed:",s),s}},B=async()=>{try{e.value&&await f.post(h.AUTH.LOGOUT)}catch(r){console.error("Logout request failed:",r)}finally{e.value="",u.value="",o.value=null,localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user")}},w=()=>{const r=localStorage.getItem("user");if(r&&e.value)try{o.value=JSON.parse(r)}catch(s){console.error("Failed to parse saved user data:",s),B()}};return{token:S(e),refreshToken:S(u),user:S(o),isLoading:S(i),isAuthenticated:n,userRoles:a,userPermissions:t,hasPermission:l,hasRole:m,login:p,register:F,refreshAccessToken:d,fetchUserProfile:v,updateProfile:R,changePassword:C,logout:B,initAuth:w}}),Q={id:"app"},ee=N({__name:"App",setup(e){const u=A();return x(()=>{u.initAuth()}),(o,i)=>{const n=M("router-view");return H(),V("div",Q,[j(n)])}}}),g=G(ee),te=q();g.use(te);g.use(W,{locale:K});for(const[e,u]of Object.entries(z))g.component(e,u);g.use(L);const re=A();re.initAuth();g.mount("#app");export{I as A,A as u};
//# sourceMappingURL=index-BKI_CO4v.js.map
