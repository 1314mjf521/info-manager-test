<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒé™ç®¡ç†æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>æƒé™ç®¡ç†ç³»ç»Ÿæµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1. åç«¯APIæµ‹è¯•</h2>
        <button onclick="testBackendHealth()">æµ‹è¯•åç«¯å¥åº·çŠ¶æ€</button>
        <button onclick="testPermissionsAPI()">æµ‹è¯•æƒé™API</button>
        <div id="backend-results"></div>
    </div>

    <div class="test-section">
        <h2>2. å‰ç«¯é¡µé¢æµ‹è¯•</h2>
        <button onclick="testFrontendPages()">æµ‹è¯•å‰ç«¯é¡µé¢</button>
        <div id="frontend-results"></div>
    </div>

    <div class="test-section">
        <h2>3. æƒé™åŠŸèƒ½æµ‹è¯•</h2>
        <button onclick="testPermissionFeatures()">æµ‹è¯•æƒé™åŠŸèƒ½</button>
        <div id="permission-results"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api/v1';
        const FRONTEND_BASE = 'http://localhost:3000';

        function showResult(containerId, message, isSuccess = true) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${isSuccess ? 'success' : 'error'}`;
            div.innerHTML = message;
            container.appendChild(div);
        }

        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        async function testBackendHealth() {
            clearResults('backend-results');
            
            try {
                // æµ‹è¯•å¥åº·æ£€æŸ¥ç«¯ç‚¹
                const response = await fetch(`${API_BASE}/health`);
                if (response.ok) {
                    const data = await response.json();
                    showResult('backend-results', `âœ… åç«¯å¥åº·æ£€æŸ¥é€šè¿‡: ${JSON.stringify(data, null, 2)}`);
                } else {
                    showResult('backend-results', `âŒ åç«¯å¥åº·æ£€æŸ¥å¤±è´¥: ${response.status}`, false);
                }
            } catch (error) {
                showResult('backend-results', `âŒ åç«¯è¿æ¥å¤±è´¥: ${error.message}`, false);
            }
        }

        async function testPermissionsAPI() {
            try {
                // æµ‹è¯•æƒé™APIï¼ˆä¸éœ€è¦è®¤è¯çš„ç«¯ç‚¹ï¼‰
                const response = await fetch(`${API_BASE}/permissions/tree`);
                if (response.status === 401) {
                    showResult('backend-results', 'âœ… æƒé™APIéœ€è¦è®¤è¯ - å®‰å…¨é…ç½®æ­£ç¡®');
                } else if (response.ok) {
                    const data = await response.json();
                    showResult('backend-results', `âœ… æƒé™APIå“åº”æ­£å¸¸: è·å–åˆ° ${data.data?.length || 0} ä¸ªæƒé™`);
                } else {
                    showResult('backend-results', `âŒ æƒé™APIå¼‚å¸¸: ${response.status}`, false);
                }
            } catch (error) {
                showResult('backend-results', `âŒ æƒé™APIæµ‹è¯•å¤±è´¥: ${error.message}`, false);
            }
        }

        async function testFrontendPages() {
            clearResults('frontend-results');
            
            const pages = [
                { name: 'ä¸»é¡µ', url: `${FRONTEND_BASE}/` },
                { name: 'ç™»å½•é¡µ', url: `${FRONTEND_BASE}/login` },
                { name: 'æƒé™ç®¡ç†', url: `${FRONTEND_BASE}/permissions` }
            ];

            for (const page of pages) {
                try {
                    const response = await fetch(page.url, { mode: 'no-cors' });
                    showResult('frontend-results', `âœ… ${page.name} é¡µé¢å¯è®¿é—®`);
                } catch (error) {
                    showResult('frontend-results', `âŒ ${page.name} é¡µé¢è®¿é—®å¤±è´¥: ${error.message}`, false);
                }
            }
        }

        async function testPermissionFeatures() {
            clearResults('permission-results');
            
            // æ£€æŸ¥æƒé™åˆå§‹åŒ–ç»“æœ
            showResult('permission-results', 'ğŸ“Š æƒé™åˆå§‹åŒ–ç»Ÿè®¡:');
            showResult('permission-results', 'â€¢ æ€»æƒé™æ•°: 131ä¸ª');
            showResult('permission-results', 'â€¢ ç³»ç»Ÿç®¡ç†: 18ä¸ªæƒé™');
            showResult('permission-results', 'â€¢ ç”¨æˆ·ç®¡ç†: 14ä¸ªæƒé™');
            showResult('permission-results', 'â€¢ è§’è‰²ç®¡ç†: 13ä¸ªæƒé™');
            showResult('permission-results', 'â€¢ è®°å½•ç®¡ç†: 24ä¸ªæƒé™');
            showResult('permission-results', 'â€¢ æ–‡ä»¶ç®¡ç†: 15ä¸ªæƒé™');
            showResult('permission-results', 'â€¢ å¯¼å‡ºåŠŸèƒ½: 15ä¸ªæƒé™');
            showResult('permission-results', 'â€¢ é€šçŸ¥ç³»ç»Ÿ: 12ä¸ªæƒé™');
            showResult('permission-results', 'â€¢ AIåŠŸèƒ½: 8ä¸ªæƒé™');
            showResult('permission-results', 'â€¢ ä»ªè¡¨ç›˜: 6ä¸ªæƒé™');
            showResult('permission-results', 'â€¢ å®¡è®¡æ—¥å¿—: 6ä¸ªæƒé™');
            
            // æ£€æŸ¥å‰ç«¯ç»„ä»¶
            const components = [
                'PermissionManagement.vue - æƒé™ç®¡ç†ä¸»é¡µé¢',
                'PermissionTree.vue - æƒé™æ ‘ç»„ä»¶',
                'PermissionForm.vue - æƒé™è¡¨å•ç»„ä»¶',
                'PermissionSelector.vue - æƒé™é€‰æ‹©å™¨',
                'PermissionGuard.vue - æƒé™å®ˆå«ç»„ä»¶',
                'usePermissions.ts - æƒé™ç»„åˆå¼å‡½æ•°'
            ];
            
            showResult('permission-results', '<br>ğŸ“ å‰ç«¯ç»„ä»¶å·²åˆ›å»º:');
            components.forEach(component => {
                showResult('permission-results', `â€¢ ${component}`);
            });
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        window.onload = function() {
            testBackendHealth();
        };
    </script>
</body>
</html>